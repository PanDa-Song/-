# synchronized 原理



根据获取的锁分类：获取**对象锁**和获取**类锁**

- 获取对象锁
    1. 同步代码块，锁的小括号中的实例对象
    2. 同步非静态方法，锁是当前对象的实例对象
- 获取类锁
    1. 同步代码块，synchronized(类.class)，小括号中是类对象
    2. 同步静态方法，锁是当前对象的类对象



## 底层实现原理



### Java 对象头

对象在内存中的布局：

- 对象头
- 实例数据
- 对齐填充

对象头结构：

- Mark Word：默认存储对象的hashCode，分代年龄，锁类型，锁标志位等信息
- Class Metadata Address：类型指针指向对象的类元数据，JVM 通过这个指针确定该对象是哪个类的数据



### Monitor

每个 Java 对象天生自带了一把看不见的锁，也称为管程

在 class 字节码文件中通过`moniterenter`和`monitorexit`